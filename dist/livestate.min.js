/*!
 * live state observer
 *
 * @author Robert Kummer
 * @license MIT
 */function LiveState(e,t){this.window=e||window,this.element=t||document.getElementsByTagName("html").item(0),this.init()}function Sensor(e){this.name=e}function ConnectionSensor(){Sensor.call(this,"connection"),this.state="offline;"}function CookieSensor(){Sensor.call(this,"cookies")}function DragDropSensor(){Sensor.call(this,"cookies")}function UserAgentSensor(){Sensor.call(this,"useragent")}function UserInputSensor(){Sensor.call(this,"userinput"),this.input="mouse"}function ViewportSensor(){Sensor.call(this,"viewport"),this.dimension="square"}function WindowFocusSensor(){Sensor.call(this,"windowfocus"),this.focus="focus"}LiveState.prototype={constructor:LiveState,init:function(){this.set("js").unset("no-js")},on:function(e,t,n){var o="string"==typeof e?new Array(e):e;o.forEach(function(e){this.window.addEventListener(e,t)},liveState);var s=n||!1;return s&&o.forEach(function(e){this.window.dispatchEvent(new Event(e))},liveState),this},set:function(e,t){var n="string"==typeof e?new Array(e):e,o=t||this.element;return n.forEach(function(e){o.classList.contains(e)||o.classList.add(e)},liveState),this},unset:function(e,t){var n="string"==typeof e?new Array(e):e,o=t||this.element;return n.forEach(function(e){o.classList.contains(e)&&o.classList.remove(e)},liveState),this},sensor:function(e){e.constructor instanceof Sensor.constructor&&e.execute(this)},sensorChanged:function(e){return e.constructor instanceof Sensor.constructor&&void 0!==this.element.dataset.livestate&&"true"===this.element.dataset.livestate&&(this.element.dataset=e.dataset(this.element.dataset)),this}},Sensor.prototype={constructor:Sensor,execute:function(){console.log('executing sensor "'+this.name+'"')},dataset:function(e){return e[this.name]=!0,e}},ConnectionSensor.prototype=Object.create(Sensor.prototype),ConnectionSensor.prototype.constructor=ConnectionSensor,ConnectionSensor.prototype.execute=function(e){var t=this;e.on(["online","offline"],function(){navigator.onLine?(t.state="online",e.set("online").unset("offline").sensorChanged(t)):(t.state="offline",e.set("offline").unset("online").sensorChanged(t))},!0)},ConnectionSensor.prototype.dataset=function(e){return e[this.name]=this.state,e},CookieSensor.prototype=Object.create(Sensor.prototype),CookieSensor.prototype.constructor=CookieSensor,CookieSensor.prototype.execute=function(e){var t=this;e.set(navigator.cookieEnabled?"cookies":"no-cookies").unset(navigator.cookieEnabled?"no-cookies":"cookies").sensorChanged(t)},DragDropSensor.prototype=Object.create(Sensor.prototype),DragDropSensor.prototype.constructor=DragDropSensor,DragDropSensor.prototype.execute=function(e){var t=this;e.on("dragstart",function(){e.set("dragging").sensorChanged(t)}),e.on("dragend",function(){e.unset("dragging").sensorChanged(t)}),e.on(["dragenter","dragover","dragleave"],function(){e.set("dropping").sensorChanged(t)}),e.on(["drop"],function(){e.unset("dropping").sensorChanged(t)})},DragDropSensor.prototype.dataset=function(e){return e},UserAgentSensor.prototype=Object.create(Sensor.prototype),UserAgentSensor.prototype.constructor=UserAgentSensor,UserAgentSensor.prototype.extractUserAgent=function(e){var t=/(([\w\-]+)\/([\d\.]{1,}))$/i,n=t.exec(e);return null==n?"":(this.useragent=n[2],void(this.version=n[3]))},UserAgentSensor.prototype.execute=function(e){var t=this;this.extractUserAgent(navigator.userAgent),e.set(this.useragent.toLowerCase()).sensorChanged(t)},UserAgentSensor.prototype.dataset=function(e){return e[this.name]=this.useragent,e[this.name+".version"]=this.version,e},UserInputSensor.prototype=Object.create(Sensor.prototype),UserInputSensor.prototype.constructor=UserInputSensor,UserInputSensor.prototype.execute=function(e){var t=this;e.on(["click","mousemove"],function(){t.input="mouse",e.set("mouse").unset("keyboard").sensorChanged(t)},!0),e.on("keypress",function(){t.input="keyboard",e.set("keyboard").unset("mouse").sensorChanged(t)})},UserInputSensor.prototype.dataset=function(e){return e[this.name]=this.input,e},ViewportSensor.prototype=Object.create(Sensor.prototype),ViewportSensor.prototype.constructor=ViewportSensor,ViewportSensor.prototype.execute=function(e){var t=this;e.on("resize",function(){var n="square";this.window.innerWidth>this.window.innerHeight?n="landscape":this.window.innerWidth<this.window.innerHeight&&(n="portrait"),t.dimension=n,e.unset(["landscape","portrait","square"]).set(n).sensorChanged(t)},!0)},ViewportSensor.prototype.dataset=function(e){return e[this.name]=this.dimension,e},WindowFocusSensor.prototype=Object.create(Sensor.prototype),WindowFocusSensor.prototype.constructor=WindowFocusSensor,WindowFocusSensor.prototype.execute=function(e){var t=this;e.on("blur",function(){t.focus="blur",e.set("blur").unset("focus").sensorChanged(t)}),e.on("focus",function(){t.focus="focus",e.set("focus").unset("blur").sensorChanged(t)},!0)},WindowFocusSensor.prototype.dataset=function(e){return e[this.name]=this.focus,e};var liveState=liveState||new LiveState;liveState.sensor(new UserAgentSensor),liveState.sensor(new CookieSensor),liveState.sensor(new ConnectionSensor),liveState.sensor(new UserInputSensor),liveState.sensor(new ViewportSensor),liveState.sensor(new WindowFocusSensor),liveState.sensor(new DragDropSensor);